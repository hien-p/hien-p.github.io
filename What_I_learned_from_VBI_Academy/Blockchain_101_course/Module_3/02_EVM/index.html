<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><link href=https://hien-p.github.io/hari-docs/What_I_learned_from_VBI_Academy/Blockchain_101_course/Module_3/02_EVM/ rel=canonical><link rel="shortcut icon" href=../../../../img/favicon.ico><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>Ethereum Virtual Machine (EVM) - Harry's Blog</title><link href=../../../../css/bootstrap-3.3.7.min.css rel=stylesheet><link href=../../../../css/font-awesome-4.7.0.css rel=stylesheet><link href=../../../../css/base.css rel=stylesheet><link rel=stylesheet href=../../../../css/highlight.css><link href=../../../../css/custom.css rel=stylesheet><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]--><!-- mkdocs_windmill/partials/scripts.html --><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-S5RMPC6VZL"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-S5RMPC6VZL');
</script><script src=../../../../js/jquery-3.2.1.min.js></script><script src=../../../../js/bootstrap-3.3.7.min.js></script><script src=../../../../js/highlight.pack.js></script><base target=_top><script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Ethereum Virtual Machine (EVM)", url: "#_top", children: [
          ]},
          {title: "N\u1ebfu b\u1ea1n qu\u00e1 l\u01b0\u1eddi \u0111\u1ecdc \ud83e\udd23 th\u00ec gi\u1ea3i th\u00edch ng\u1eafn g\u1ecdn l\u00e0", url: "#neu-ban-qua-luoi-oc-thi-giai-thich-ngan-gon-la", children: [
          ]},
          {title: "1. Deep dive more about EVM", url: "#1-deep-dive-more-about-evm", children: [
              {title: "1.1 VM nh\u01b0 l\u00e0 m\u1ed9t Virtual Machine", url: "#11-vm-nhu-la-mot-virtual-machine" },
          ]},
          {title: "Bytecode l\u00e0 g\u00ec ?", url: "#bytecode-la-gi", children: [
          ]},
          {title: "Deployment v\u00e0 runtime bytecode", url: "#deployment-va-runtime-bytecode", children: [
              {title: "EVM Assembly", url: "#evm-assembly" },
          ]},
          {title: "Hi\u1ec7u n\u0103ng c\u1ee7a EVM", url: "#hieu-nang-cua-evm", children: [
          ]},
        ];

    </script><script src=../../../../js/base.js></script><script src=../../../../search/main.js></script><meta property=og:title content="Harry's Blog - Developer Documentation Technical Writer ğŸš€"><meta property=og:description content="Há»c Blockchain dá»… hiá»ƒu, dÃ nh cho dev Web3"><meta property=og:image content=https://harriweb3.dev/assets/facebook_cover.png><meta property=og:type content=website><meta content=https://harriweb3.dev/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Harry's Blog - Developer Documentation Technical Writer ğŸš€ "><meta name=twitter:description content="Há»c Blockchain dá»… hiá»ƒu, dÃ nh cho dev Web3 má»›i vÃ o nghá»!"><meta name=twitter:image content=https://harriweb3.dev/assets/facebook_cover.png><link rel=stylesheet href=../../../../css/extra.css></head> <body> <script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script> <div class="container-fluid wm-page-content"> <a name=_top></a> <div class="row wm-article-nav-buttons" role=navigation aria-label=navigation> <div class="wm-article-nav pull-right"> <a href=../03_non_evm_protocols/ class="btn btn-xs btn-default pull-right"> Next <i class="fa fa-chevron-right" aria-hidden=true></i> </a> <a href=../03_non_evm_protocols/ class="btn btn-xs btn-link"> What is NON-EVM ? </a> </div> <div class=wm-article-nav> <a href=../01_01_blockchain_dilemma/ class="btn btn-xs btn-default pull-left"> <i class="fa fa-chevron-left" aria-hidden=true></i> Previous</a><a href=../01_01_blockchain_dilemma/ class="btn btn-xs btn-link"> The blockchain trilemma </a> </div> </div> <h1 id=ethereum-virtual-machine-evm>Ethereum Virtual Machine (EVM)<a class=headerlink href=#ethereum-virtual-machine-evm title="Permanent link">&para;</a></h1> <p><img alt src="https://ethereum.org/_next/image/?url=%2Fcontent%2Fdevelopers%2Fdocs%2Fevm%2Fevm.png&w=1920&q=75"></p> <p>Diagram adapted from <a href=https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf>Ethereum EVM illustrated</a></p> <blockquote> <p>The EVM is the part of Ethereum that handles the deployment and execution of smart contracts. In reality, a simple value transfer transaction from one EOA to another does not require the EVM, but everything else will involve state updates computed by the EVM. From a higher level perspective, the EVM running on the Ethereum blockchain can be viewed as a global decentralized computer containing millions of executable objects, each with its own permanent data storage.</p> </blockquote> <p><em>â€”Andreas Antonopoulos** and Dr. Gavin Wood, Mastering Ethereum</em></p> <hr> <p>Táº¡m dá»‹ch: </p> <blockquote> <p>EVM lÃ  pháº§n trong Ethereum chá»‹u trÃ¡ch nhiá»‡m triá»ƒn khai vÃ  thá»±c thi cÃ¡c smart contract. Thá»±c táº¿, náº¿u chá»‰ Ä‘Æ¡n giáº£n chuyá»ƒn giÃ¡ trá»‹ (value transfer) tá»« má»™t vÃ­ thÃ´ng thÆ°á»ng (EOA) sang vÃ­ khÃ¡c thÃ¬ khÃ´ng cáº§n Ä‘áº¿n EVM. NhÆ°ng báº¥t ká»³ hÃ nh Ä‘á»™ng nÃ o khÃ¡c Ä‘á»u sáº½ liÃªn quan Ä‘áº¿n viá»‡c cáº­p nháº­t tráº¡ng thÃ¡i (state) do EVM tÃ­nh toÃ¡n.</p> <p>Náº¿u nhÃ¬n á»Ÿ gÃ³c Ä‘á»™ trá»«u tÆ°á»£ng hÆ¡n, EVM cháº¡y trÃªn blockchain Ethereum cÃ³ thá»ƒ Ä‘Æ°á»£c xem nhÆ° má»™t chiáº¿c mÃ¡y tÃ­nh phi táº­p trung toÃ n cáº§u, nÆ¡i chá»©a hÃ ng triá»‡u â€œÄ‘á»‘i tÆ°á»£ng thá»±c thiâ€ (executable objects) má»—i Ä‘á»‘i tÆ°á»£ng cÃ³ khÃ´ng gian lÆ°u trá»¯ dá»¯ liá»‡u riÃªng vÃ  tá»“n táº¡i vÄ©nh viá»…n.</p> </blockquote> <hr> <h1 id=neu-ban-qua-luoi-oc-thi-giai-thich-ngan-gon-la>Náº¿u báº¡n quÃ¡ lÆ°á»i Ä‘á»c ğŸ¤£ thÃ¬ giáº£i thÃ­ch ngáº¯n gá»n lÃ <a class=headerlink href=#neu-ban-qua-luoi-oc-thi-giai-thich-ngan-gon-la title="Permanent link">&para;</a></h1> <p>Ethereum Virtual Machine (EVM) cÃ³ thá»ƒ Ä‘Æ°á»£c hiá»ƒu Ä‘Æ¡n giáº£n lÃ  má»™t mÃ´i trÆ°á»ng Ä‘á»™c láº­p, Ä‘Æ°á»£c thiáº¿t káº¿ riÃªng Ä‘á»ƒ xá»­ lÃ½ cÃ¡c giao dá»‹ch liÃªn quan Ä‘áº¿n smart contract, vÃ  quan trá»ng hÆ¡n cáº£ lÃ  <strong>xÃ¡c Ä‘á»‹nh state tá»•ng thá»ƒ cá»§a blockchain Ethereum</strong> sau má»—i block má»›i Ä‘Æ°á»£c táº¡o ra.</p> <p>Báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng EVM nhÆ° má»™t chiáº¿c mÃ¡y tÃ­nh chuyÃªn xá»­ lÃ½ cÃ¡c giao dá»‹ch smart contract, Ä‘á»“ng thá»i Ä‘á»‹nh nghÄ©a cÃ¡c quy táº¯c thay Ä‘á»•i tráº¡ng thÃ¡i cá»§a máº¡ng Ethereum theo tá»«ng block.</p> <p>Tuy nhiÃªn, khÃ¡c vá»›i mÃ¡y tÃ­nh váº­t lÃ½, EVM lÃ  má»™t mÃ¡y áº£o nÃ³ khÃ´ng phá»¥ thuá»™c vÃ o há»‡ Ä‘iá»u hÃ nh cá»¥ thá»ƒ hay vá»‹ trÃ­ Ä‘á»‹a lÃ½ nÃ o cáº£. ChÃ­nh vÃ¬ váº­y, báº¥t ká»³ ai á»Ÿ báº¥t ká»³ Ä‘Ã¢u Ä‘á»u cÃ³ thá»ƒ truy cáº­p vÃ  váº­n hÃ nh má»™t node Ethereum Ä‘á»ƒ cháº¡y EVM.</p> <h1 id=1-deep-dive-more-about-evm>1. Deep dive more about EVM<a class=headerlink href=#1-deep-dive-more-about-evm title="Permanent link">&para;</a></h1> <p>CÃ³ nhiá»u cÃ¡ch khÃ¡u nhau Ä‘á»ƒ má»i ngÆ°á»i mÃ´ táº£ vá» EVM. NhÆ° lÃ  </p> <ul> <li>EVM nhÆ° lÃ  má»™t Vitural Machine ( mÃ¡y áº£o)</li> <li>EVM lÃ  State machine </li> <li>Hay EVM lÃ  Quasi-Turing Complete Machine </li> </ul> <p>Má»™t sá»‘ thuáº­t ngá»¯ Ä‘Ã¢y sáº½ nghe cÃ³ váº» láº¡ nhÆ°ng thá»±c ra má»—i Ä‘á»‹nh nghÄ©a trÃªn Ä‘á»u theo tá»«ng gÃ³c nhÃ¬n khÃ¡c nhau vá» EVM. VÃ  táº¥t cáº£ Ä‘á»u Ä‘Ãºng theo gÃ³c nhÃ¬n Ä‘Ã³. </p> <h2 id=11-vm-nhu-la-mot-virtual-machine>1.1 VM nhÆ° lÃ  má»™t Virtual Machine<a class=headerlink href=#11-vm-nhu-la-mot-virtual-machine title="Permanent link">&para;</a></h2> <p>Äá»ƒ hiá»ƒu Ä‘Æ°á»£c pháº§n <a href="https://en.wikipedia.org/wiki/Virtual_machine?ref=decipherclub.com">â€œVirtual Machineâ€</a> trong cÃ¡i tÃªn EVM (Ethereum Virtual Machine), tá»¥i mÃ¬nh cáº§n quay láº¡i má»™t chÃºt vÃ¨ <strong>physical machines</strong>.</p> <p>ÄÃ³ lÃ  x86, ARM, hay Apple M1 mÃ  mÃ¡y tÃ­nh báº¡n Ä‘ang cháº¡y. á» Layer tháº¥p nháº¥t, máº¥y nÃ y chá»‰ hiá»ƒu Ä‘Æ°á»£c nhá»‹ phÃ¢n tá»©c lÃ  dÃ£y sá»‘ 0 vÃ  1. Má»i thao tÃ¡c nhÆ° cá»™ng, trá»«, lÆ°u file, render áº£nhâ€¦ Ä‘á»u Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn bá»Ÿi chuá»—i opcode lÃ  lá»‡nh mÃ¡y tÃ­nh Ä‘á»c Ä‘Æ°á»£c â€“ toÃ n sá»‘ 0 vÃ  1.</p> <p>khÃ¡i niá»‡m Virtual Machine (VM) â€“ mÃ¡y áº£o. VM vá» cÆ¡ báº£n cÅ©ng hoáº¡t Ä‘á»™ng y chang mÃ¡y tháº­t lÃ  cÃ³ opcode, cÃ³ cÃ¡c bÆ°á»›c thá»±c thi logic. Má»™t sá»‘ vÃ­ dá»¥ quen thuá»™c lÃ  <strong>JVM (Java Virtual Machine)</strong> hay <strong>LLVM</strong> trong há»‡ sinh thÃ¡i cá»§a nhiá»u ngÃ´n ngá»¯ nhÆ° Rust, C, Swiftâ€¦</p> <p>NhÆ°ng Ä‘iá»ƒm khÃ¡c biá»‡t quan trá»ng lÃ : VM khÃ´ng bá»‹ gáº¯n vá»›i pháº§n cá»©ng cá»¥ thá»ƒ nÃ o. Báº¡n cÃ³ thá»ƒ cháº¡y má»™t virtual machine trÃªn báº¥t ká»³ loáº¡i mÃ¡y nÃ o, há»‡ Ä‘iá»u hÃ nh nÃ o miá»…n lÃ  cÃ³ pháº§n má»m support nÃ³. <strong>Tá»©c lÃ  VM mang láº¡i má»™t mÃ´i trÆ°á»ng thá»±c thi Ä‘á»™c láº­p vá»›i ná»n táº£ng</strong></p> <p>Quay láº¡i vá»›i Ethereum thÃ¬ <strong>EVM chÃ­nh lÃ  virtual machine cá»§a riÃªng Ethereum</strong>. Äiá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ cháº¡y EVM trÃªn báº¥t ká»³ há»‡ Ä‘iá»u hÃ nh nÃ o (Windows, macOS, Linuxâ€¦), trÃªn báº¥t ká»³ pháº§n cá»©ng nÃ o (PC, laptop, server, tháº­m chÃ­ Raspberry Pi), miá»…n lÃ  báº¡n cÃ i má»™t <strong>Ethereum node</strong>.</p> <p>ÄÃ¢y chÃ­nh lÃ  Ä‘iá»ƒm then chá»‘t khiáº¿n Ethereum thá»±c sá»± phi táº­p trung (decentralized)vÃ¬ ai cÅ©ng cÃ³ thá»ƒ cháº¡y EVM á»Ÿ báº¥t cá»© Ä‘Ã¢u.</p> <hr> <blockquote> <p>In the pre-EVM era, this would have been a nightmare as a new blockchain with custom logic had to be created every time a new app with specific use case was to be built.</p> </blockquote> <p>Táº¡m dá»‹ch lÃ : TrÆ°á»›c khi cÃ³ EVM, náº¿u báº¡n muá»‘n cháº¡y má»™t app cÃ³ logic riÃªng trÃªn blockchain, báº¡n pháº£i táº¡o nguyÃªn má»™t blockchain má»›i tá»« thiáº¿t káº¿, consensus, state machineâ€¦ cá»±c ká»³ tá»‘n cÃ´ng.</p> <hr> <p>NhÆ°ng giá» cÃ³ thá»ƒ viáº¿t báº¥t ká»³ á»©ng dá»¥ng nÃ o báº±ng Solidity â†’ biÃªn dá»‹ch thÃ nh EVM bytecode â†’ deploy lÃªn Ethereum â†’ cháº¡y ngay trong EVM. NÃ³i cÃ¡ch khÃ¡c, EVM biáº¿n Ethereum thÃ nh má»™t â€œmÃ¡y tÃ­nh global, cÃ³ thá»ƒ cháº¡y báº¥t ká»³ Ä‘oáº¡n arbitrary code nÃ o.</p> <h1 id=bytecode-la-gi>Bytecode lÃ  gÃ¬ ?<a class=headerlink href=#bytecode-la-gi title="Permanent link">&para;</a></h1> <p>Bytecode basically lÃ  â€œmachine codeâ€ Ä‘Æ°á»£c generate sau khi compile ngÃ´n ngá»¯ smart contract cáº¥p cao nhÆ° Solidity. NÃ³ kiá»ƒu nhÆ° váº§y (sá»‘ liá»‡u dÃ i quÃ¡ nÃªn mÃ¬nh bá» bá»›t):</p> <p><img alt src=https://img.learnblockchain.cn/2020/07/08/15941927182518.jpg></p> <p>Táº¡i vÃ¬ náº¿u báº¡n khÃ´ng cÃ³ source code vÃ  ABI (Application Binary Interface) cá»§a smart contract Ä‘Ã³ thÃ¬ viá»‡c tÆ°Æ¡ng tÃ¡c vá»›i nÃ³ trÃªn blockchain sáº½ ráº¥t risky vÃ  dá»… sai.</p> <p>Äoáº¡n bytecode mÃ  mÃ¬nh show phÃ­a trÃªn chÃ­nh lÃ  <code>deployment bytecode</code> cá»§a contract HelloWorld.sol lÃ  contract máº«u mÃ  tá»¥i mÃ¬nh Ä‘Ã£ deploy.</p> <h1 id=deployment-va-runtime-bytecode>Deployment vÃ  runtime bytecode<a class=headerlink href=#deployment-va-runtime-bytecode title="Permanent link">&para;</a></h1> <p>KhÃ¡c vá»›i <strong>runtime bytecode</strong>, deployment bytecode sáº½ gá»“m thÃªm máº¥y code há»— trá»£ (<strong>auxiliary code</strong>) Ä‘á»ƒ giÃºp quÃ¡ trÃ¬nh deploy diá»…n ra thÃ nh cÃ´ng. Sau khi contract Ä‘Æ°á»£c deploy thÃ nh cÃ´ng, chá»‰ cÃ²n runtime bytecode á»Ÿ láº¡i náº±m táº¡i Ä‘á»‹a chá»‰ contract trÃªn blockchain Ä‘Ã¢y chÃ­nh lÃ  pháº§n sáº½ Ä‘Æ°á»£c EVM dÃ¹ng má»—i khi cÃ³ ngÆ°á»i gá»i hÃ m cá»§a contract Ä‘Ã³.</p> <h2 id=evm-assembly>EVM Assembly<a class=headerlink href=#evm-assembly title="Permanent link">&para;</a></h2> <p>Solidity compiler cÃ³ thá»ƒ in ra phiÃªn báº£n <code>human-readable</code> cá»§a EVM Assembly cho contract <code>HelloWorld.sol</code>. </p> <p>Khi báº¡n biÃªn dá»‹ch contract, báº¡n khÃ´ng chá»‰ ra bytecode mÃ  cÃ²n cÃ³ thá»ƒ láº¥y cáº£ assembly code, tá»©c lÃ  ngÃ´n ngá»¯ gáº§n sÃ¡t mÃ¡y nháº¥t nhÆ°ng váº«n cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c pháº§n nÃ o náº¿u báº¡n Ä‘Ã£ quen vá»›i EVM.</p> <p>VÃ­ dá»¥ Ä‘oáº¡n dÆ°á»›i lÃ  má»™t pháº§n cá»§a EVM assembly cho contract <code>HelloWorld</code>:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>mstore</span><span class=p>(</span><span class=mh>0x40</span><span class=p>,</span><span class=w> </span><span class=mh>0x80</span><span class=p>)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>callvalue</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>dup1</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>iszero</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=n>jumpi</span><span class=p>(</span><span class=n>tag_1</span><span class=p>)</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=o>..</span><span class=p>.</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>greeting</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Hello, World.&quot;</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=mh>0x48656c6c6f2c20576f726c642e</span><span class=o>..</span><span class=p>.</span>
</span></code></pre></div> <p><img alt src=https://img.learnblockchain.cn/2020/07/08/15941926928582.jpg></p> <p>Smart contracts cÃ³ thá»ƒ Ä‘Æ°á»£c compiled thÃ nh EVM bytecode. HÃ¬nh dung cho dá»… thif Solidity code ngÃ´n ngá»¯ Ä‘á»ƒ viáº¿t smart contractgiá»‘ng nhÆ° C++ trong láº­p trÃ¬nh truyá»n thá»‘ng. </p> <p>CÃ²n <code>EVM bytecode</code> thÃ¬ nhÆ° machine code mÃ  CPU hiá»ƒu Ä‘Æ°á»£c.</p> <p><code>EVM bytecode</code> lÃ  má»™t chuá»—i cÃ¡c opcode (operation code) vÃ  dá»¯ liá»‡u, Ä‘Æ°á»£c EVM xá»­ lÃ½ Ä‘á»ƒ thá»±c hiá»‡n state transition â€“ tá»©c lÃ  thay Ä‘á»•i tráº¡ng thÃ¡i toÃ n cá»¥c cá»§a Ethereum sau má»—i giao dá»‹ch hoáº·c function call trong smart contract.</p> <blockquote> <p>Váº­y rá»‘t cuá»™c vai trÃ² cá»§a EVM trong viá»‡c execute má»™t transaction lÃ  gÃ¬?</p> </blockquote> <p>Äáº§u tiÃªn, nÃ³ cho phÃ©p chuyá»ƒn WEI (1 ETH = 10Â¹â¸ WEI) tá»« account nÃ y sang account khÃ¡c.</p> <p>VÃ  náº¿u account nháº­n Ä‘Æ°á»£c giao dá»‹ch Ä‘Ã³ cÃ³ chá»©a bytecode liÃªn quan tá»›i EVM, thÃ¬ EVM sáº½ pháº£i cháº¡y cÃ¡i Ä‘oáº¡n <code>bytecode</code> Ä‘Ã³ cÃ³ thá»ƒ kÃ¨m theo <code>transaction.data</code> lÃ m input (input nÃ y lÃ  dá»¯ liá»‡u tá»« trÆ°á»ng data cá»§a transaction).</p> <blockquote> <p>Váº­y account nÃ o cÅ©ng cÃ³ bytecode háº¿t Ã ?â€</p> </blockquote> <p>CÃ¢u tráº£ lá»i lÃ : khÃ´ng.</p> <p>Trong Ethereum, chá»‰ cÃ³ 2 loáº¡i account:</p> <ul> <li> <p>EOA (Externally Owned Account): LÃ  account do má»™t ngÆ°á»i/ tá»• chá»©c kiá»ƒm soÃ¡t thÃ´ng qua private key. Kiá»ƒu nhÆ° vÃ­ Metamask cá»§a báº¡n áº¥y.</p> </li> <li> <p>CA (Contract Account): LÃ  account Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch deploy smart contract. Nhá»¯ng account nÃ y khÃ´ng cÃ³ private key, vÃ  Ä‘Æ°á»£c control bá»Ÿi code, thÃ´ng qua cÃ¡c call tá»« EOA (transaction).</p> </li> </ul> <p>NÃ³i Ä‘Æ¡n giáº£n, chá»‰ cÃ³ <code>Contract Account</code> má»›i chá»©a <code>bytecode</code> Ä‘á»ƒ EVM thá»±c thi. Letâ€™s dive deeperâ€¦ vÃ o kiáº¿n trÃºc bÃªn trong cá»§a EVM:</p> <p><img alt="image " src=https://img.learnblockchain.cn/attachments/2021/11/oeU12q7B619b5741a42fc.png></p> <p><em>Diagram from <a href=https://ethereum.org/en/developers/docs/evm/ >https://ethereum.org/en/developers/docs/evm/</a></em></p> <p>Má»—i EVM instance Ä‘Æ°á»£c khá»Ÿi cháº¡y lÃ  Ä‘á»ƒ thá»±c thi má»™t Ä‘oáº¡n bytecode cá»¥ thá»ƒ (vÃ¬ má»¥c tiÃªu cá»§a transaction lÃ  má»™t Contract Account). Do Ä‘Ã³, Ä‘oáº¡n bytecode nÃ y hoáº¡t Ä‘á»™ng nhÆ° ROM, bá»™ nhá»› chá»‰ Ä‘á»c cá»§a <code>EVM instance</code>, vÃ  táº¥t nhiÃªn lÃ  khÃ´ng thá»ƒ bá»‹ thay Ä‘á»•i sau khi Ä‘Ã£ deploy.</p> <p>TÆ°á»Ÿng tÆ°á»£ng giá»‘ng nhÆ° má»™t <a href=https://en.wikipedia.org/wiki/Turing_machine>Turing Machine</a>, EVM cÅ©ng cÃ³ cÃ¡c thÃ nh pháº§n cÆ¡ báº£n gá»“m:</p> <ul> <li> <p>Program Counter (PC): LÃ  má»™t con trá» chá»‰ tá»›i opcode tiáº¿p theo trong bytecode mÃ  EVM cáº§n thá»±c thi. PC lÃ  sá»‘ nguyÃªn khÃ´ng Ã¢m trong khoáº£ng <code>[0, sá»‘ lÆ°á»£ng byte cá»§a bytecode - 1].</code></p> </li> <li> <p>Memory: LÃ  bá»™ nhá»› táº¡m, cÃ³ thá»ƒ má»Ÿ rá»™ng vÃ´ háº¡n (miá»…n lÃ  báº¡n chá»‹u tráº£ thÃªm phÃ­ gas cho viá»‡c má»Ÿ rá»™ng). Má»—i slot trong memory lÃ  1 byte (unsigned 8-bit integer).</p> </li> <li> <p>Stack: Stack trong EVM cÃ³ thá»ƒ chá»©a tá»‘i Ä‘a <code>1024 pháº§n tá»­</code>, má»—i pháº§n tá»­ lÃ  má»™t unsigned integer 256-bit (tá»©c 32 byte). ÄÃ¢y lÃ  nÆ¡i cÃ¡c giÃ¡ trá»‹ trung gian Ä‘Æ°á»£c xá»­ lÃ½ liÃªn tá»¥c nhÆ° push, pop, add, sub, v.v.</p> </li> <li> <p>External Storage: vÃ¹ng lÆ°u trá»¯ permanent cá»§a cÃ¡c account, nÆ¡i contract cÃ³ thá»ƒ lÆ°u state. EVM bytecode cÃ³ thá»ƒ Ä‘á»c/ghi vÃ o storage cá»§a account hiá»‡n táº¡i hoáº·c external account khÃ¡c</p> </li> </ul> <p>Trong Ä‘Ã³, <code>external storage</code> lÃ  nÆ¡i lÆ°u trá»¯ vÄ©nh viá»…n táº¥t cáº£ tráº¡ng thÃ¡i vÃ  dá»¯ liá»‡u liÃªn quan Ä‘áº¿n smart contract.</p> <p>NgÆ°á»£c láº¡i, cÃ¡c thÃ nh pháº§n cÃ²n láº¡i nhÆ°<code>PC, stack, vÃ  memory</code> Ä‘á»u lÃ  volatile â€“ tá»©c lÃ  chá»‰ tá»“n táº¡i trong lÃºc EVM instance Ä‘ang cháº¡y vÃ  sáº½ bá»‹ reset má»—i láº§n instance má»›i Ä‘Æ°á»£c táº¡o.</p> <hr> <p>TÆ°Æ¡ng tá»± nhÆ° CPU hiá»ƒu cÃ¡c lá»‡nh trong Instruction Set, EVM cÅ©ng cáº§n hiá»ƒu cÃ¡c <code>opcode</code> (má»—i opcode lÃ  1 byte =&gt; tá»‘i Ä‘a 256 opcode). Máº·c dÃ¹ khÃ´ng liá»‡t kÃª toÃ n bá»™ á»Ÿ Ä‘Ã¢y, nhÆ°ng ta cÃ³ thá»ƒ chia opcode thÃ nh cÃ¡c nhÃ³m chÃ­nh nhÆ° sau:</p> <ul> <li>Control Opcodes: Ä‘iá»u khiá»ƒn PC, stack, memory, storage</li> <li>Arithmetic &amp; Bitwise: nhÆ° ADD, MUL, AND, OR, XORâ€¦</li> <li>Contextual Info: truy xuáº¥t thÃ´ng tin block, transaction, msg.sender</li> <li>Log: táº¡o log record (LOG0, LOG1,â€¦)</li> <li>System-level: táº¡o contract má»›i (CREATE), gá»i contract khÃ¡c (CALL, DELEGATECALL), xoÃ¡ contract (SELFDESTRUCT)</li> </ul> <h1 id=hieu-nang-cua-evm>Hiá»‡u nÄƒng cá»§a EVM<a class=headerlink href=#hieu-nang-cua-evm title="Permanent link">&para;</a></h1> <p>Khi cháº¡y trÃªn mainnet, <code>EVM (Ethereum Virtual Machine)</code> thÆ°á»ng xá»­ lÃ½ bytecode cháº­m hÆ¡n kha khÃ¡ so vá»›i cÃ¡c loáº¡i mÃ¡y áº£o thÃ´ng thÆ°á»ng. NhÆ°ng cÃ¡i nÃ y khÃ´ng pháº£i bug Ä‘Ã¢u mÃ  lÃ  tÃ­nh nÄƒng ğŸ˜. </p> <p>LÃ½ do chÃ­nh lÃ  bá»Ÿi má»—i phÃ©p toÃ¡n (operation) pháº£i Ä‘Æ°á»£c thá»±c thi bá»Ÿi táº¥t cáº£ cÃ¡c full node trong máº¡ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh trustless tá»©c khÃ´ng cáº§n tin tÆ°á»Ÿng ai mÃ  váº«n hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c.</p> <p>ChÃ­nh vÃ¬ Æ°u tiÃªn cho tÃ­nh <code>Ä‘á»“ng thuáº­n phÃ¢n tÃ¡n (decentralized consensus)</code> nÃ y mÃ  EVM cháº¥p nháº­n Ä‘Ã¡nh Ä‘á»•i xá»­ lÃ½ cháº­m hÆ¡n vÃ  chi phÃ­ tÃ­nh toÃ¡n (gas fee) cao hÆ¡n nhiá»u so vá»›i cÃ¡c há»‡ thá»‘ng táº­p trung.</p> <p>Äá»•i láº¡i thÃ¬ tÃ­nh báº¥t biáº¿n gáº§n nhÆ° tuyá»‡t Ä‘á»‘i, kháº£ nÄƒng chá»‘ng lá»—i cao, vÃ  zero downtimekhÃ´ng bá»‹ â€œnghá»‰ serverâ€ giá»¯a chá»«ng nhÆ° web2. ChÆ°a háº¿t, EVM cÃ²n cÃ³ cÆ¡ cháº¿ gas metering nhÆ° Ä‘á»“ng há»“ Ä‘o gas váº­y.</p> <p>NÃ³ Ä‘áº£m báº£o ráº±ng miners (hoáº·c validators sau The Merge) sáº½ Ä‘Æ°á»£c tráº£ cÃ´ng xá»©ng Ä‘Ã¡ng khi thÃªm transaction cá»§a báº¡n vÃ o block. Äá»“ng thá»i, cÆ¡ cháº¿ nÃ y ngÄƒn cháº·n Ä‘oáº¡n code bá»‹ loop vÃ´ táº­n. Náº¿u má»™t chÆ°Æ¡ng trÃ¬nh cháº¡y mÃ£i khÃ´ng dá»«ng vÃ  vÆ°á»£t quÃ¡ giá»›i háº¡n gas Ä‘Ã£ set, EVM sáº½ auto <em>â€œÄ‘áº­pâ€</em> giao dá»‹ch Ä‘Ã³, revert toÃ n bá»™ cÃ¡c thay Ä‘á»•i state táº¡m thá»i (sandboxed state)</p> <br> <div class="row wm-article-nav-buttons" role=navigation aria-label=navigation> <div class="wm-article-nav pull-right"> <a href=../03_non_evm_protocols/ class="btn btn-xs btn-default pull-right"> Next <i class="fa fa-chevron-right" aria-hidden=true></i> </a> <a href=../03_non_evm_protocols/ class="btn btn-xs btn-link"> What is NON-EVM ? </a> </div> <div class=wm-article-nav> <a href=../01_01_blockchain_dilemma/ class="btn btn-xs btn-default pull-left"> <i class="fa fa-chevron-left" aria-hidden=true></i> Previous</a><a href=../01_01_blockchain_dilemma/ class="btn btn-xs btn-link"> The blockchain trilemma </a> </div> </div> <br> </div> <div class=giscus-wrapper> <div class=giscus></div> <script src=https://giscus.app/client.js data-repo=hien-p/hari-docs data-repo-id=R_kgDOPQrn9w data-category=Announcements data-category-id=DIC_kwDOPQrn984CtVCd data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async>
  </script> </div> <!-- <footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer> --> </body> </html>